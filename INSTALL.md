ИНСТАЛЛЯЦИЯ
===========

Система видеоаналитики спроектирована для работы в распределенной среде и каждый сервис может быть установлен на отдельный хост.<br />
Ниже приводится инструкция для установки всех сервисов на один хост.

В качестве платформы рекомендуется использовать **CentOS Linux 7+**.

## Создание пользователя и директории
Необходимо создать пользователя, от имени которого будут запускаться все сервисы. На время инсталляции этому пользователю необходимо дать право запускать команды от имени root.<br />
Добавим пользователя **cascana** с домашней директорией **/opt/cascana** (от имени root).

  `useradd -mU cascana -d /opt/cascana -G wheel`

## Клонирование репозитория
Сперва сменим пользователя и перейдем в домашнюю директорию:

  `sudo -i -u cascana`

Далее клонируем репозиторий проекта и переходим в рабочую директорию:

  `git clone <url>`<br />
  `cd <dir>`

Все дальнейшие действия выполняем из корня рабочей директории проекта. Развертывание и запуск проекта осуществляется утилитой make. Все необходимые операции занесены в Makefile.

## Первоначальная конфигурация
Отредактируйте файл **config_files/config.sh**, снабженный комментариями. Файл содержит настройки для первоначального локального запуска системы в минимальной конфигурации.

## Сборка и развертывание

`make all`

После завершения, если конфигурация не менялась, вы сможете открыть страницы web-интерфейса по адресам:<br/>
http://localhost:8088<br/>
http://localhost:8089

Если что пошло не так - см. Makefile и config_files/config.sh.

Для использования встроенной камеры (например, /dev/video0) на Linux-машине, - добавьте пользователя видеоаналитики в группу video (от имени root):

`gpasswd -a cascana video`

# Команды Makefile

Команды безопасны при многократном вызове.

### `make all`
установка и запуск минимальной системы

### `make deps`
установка системных зависимостей

### `make node`
установка среды выполнения

### `make va`
установка зависимостей приложения, а также системных зависисмостей и среды выполнения

### `make config`
генерация конфигураций сервисов и модулей

### `make db`
установка и запуск сервера баз данных, а также создание необходимых баз

### `make pm2`
установка менеджера сервисов

### `make ffserver`
установка и сборка видеосервера

### `make cron`
установка, настройка и запуск планировщика

### `make sendmail`
установка и запуск почтового агента

### `make omnidb`
установка web-интерфейса к базе данных

### `make switch-off`
отключение firewall и SELinux (может понадобиться для запуска распределенного варианта)

### `make start`
запуск сервисов

### `make reset`
перезапуск сервисов с обновлением конфигурации

### `make stop-all`
остановка всех компонентов системы

### `make start-all`
запуск всех компонентов системы

### `make disable-all`
выключение автоматического старта всех компонентов системы

### `make enable-all`
включение автоматического старта всех компонентов системы
